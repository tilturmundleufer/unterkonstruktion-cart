!function(){"use strict";var e="foxy_session_id",o="foxy_session_expiry",t=864e5;function n(n){if(n)try{localStorage.setItem(e,n),localStorage.setItem(o,Date.now()+t);var r=new Date;r.setTime(r.getTime()+t);var s="ukc_foxy_sid="+n+"; expires="+r.toUTCString()+"; path=/";document.cookie=s+"; SameSite=Lax",document.cookie=s,console.log("[FoxyCart] Session gespeichert (localStorage + Cookie):",n.substring(0,10)+"..."),console.log("[FoxyCart] Cookie gesetzt:",document.cookie.includes("ukc_foxy_sid")?"YES":"NO")}catch(e){console.warn("[FoxyCart] Konnte Session nicht speichern:",e)}}function r(){try{var n=parseInt(localStorage.getItem(o)||"0",10);if(n>0&&n<Date.now())return localStorage.removeItem(e),localStorage.removeItem(o),console.log("[FoxyCart] Session abgelaufen"),null;var r=localStorage.getItem(e);if(r)return r;var s=document.cookie.match(/(?:^|; )ukc_foxy_sid=([^;]+)/);return s&&s[1]?(console.log("[FoxyCart] Session aus Cookie gelesen (Chrome-Fallback)"),localStorage.setItem(e,s[1]),localStorage.setItem(o,Date.now()+t),s[1]):null}catch(e){return console.warn("[FoxyCart] Konnte Session nicht lesen:",e),null}}function s(e,o){if(e&&o){var t=e.tagName.toLowerCase();if("a"===t){var n=e.getAttribute("href")||"";if(n&&!n.includes("fssid=")&&!n.includes("fc_sid=")){var r=n.includes("?")?"&":"?",s=n+r+"fssid="+o;e.setAttribute("href",s),console.log("[FoxyCart] Session zu Link hinzugefügt:",n.substring(0,50)+"...")}}else if("form"===t){var a=e.querySelector('input[name="fssid"], input[name="fc_sid"]');if(a)a.value=o;else{var i=document.createElement("input");i.type="hidden",i.name="fssid",i.value=o,e.appendChild(i),console.log("[FoxyCart] Session zu Form hinzugefügt")}}}}function a(){var e=function(){var e=new URLSearchParams(window.location.search),o=e.get("fssid")||e.get("fc_sid");if(o)return console.log("[FoxyCart] Session aus URL:",o.substring(0,10)+"..."),o;var t=document.querySelector('input[name="fssid"], input[name="fc_sid"]');if(t&&t.value)return o=t.value,console.log("[FoxyCart] Session aus Hidden Input:",o.substring(0,10)+"..."),o;if(window.FC&&FC.sid)return console.log("[FoxyCart] Session aus FC.sid:",FC.sid.substring(0,10)+"..."),FC.sid;var n=document.cookie.match(/(?:^|; )(?:fssid|fc_sid)=([^;]+)/);if(n)return console.log("[FoxyCart] Session aus Cookie:",n[1].substring(0,10)+"..."),n[1];var s=r();return s?(console.log("[FoxyCart] Session aus localStorage:",s.substring(0,10)+"..."),s):(console.warn("[FoxyCart] Keine Session gefunden!"),null)}();function o(){var o=e||r();if(o){console.log("[FoxyCart] Hänge Session an Elemente:",o.substring(0,10)+"...");var t=document.querySelectorAll('a[href*="foxycart.com/cart"], a[href*="foxycart.com"][href*="cart"], a[href*=".foxycart.com"], a[data-foxy-href]');t.forEach(function(e){s(e,o)});var n=document.querySelectorAll('form[action*="foxycart.com/cart"], form[action*="foxycart.com"][action*="cart"], form[action*=".foxycart.com"], form.foxycart, form[data-foxy-form]');n.forEach(function(e){s(e,o)});var a=document.querySelectorAll('a[href*="foxycart.com/checkout"], a[href*="/checkout"]');a.forEach(function(e){s(e,o)}),console.log("[FoxyCart] ✓ Session zu",t.length,"Links,",n.length,"Forms und",a.length,"Checkout-Links hinzugefügt")}else console.log("[FoxyCart] Keine Session zum Anhängen gefunden")}e?n(e):e=r(),e?(console.log("[FoxyCart] Verwende Session:",e.substring(0,10)+"..."),function(e){if(e){var o=0,t=function(){if(window.FC){console.log("[FoxyCart] FC Object gefunden - injiziere Session");try{FC.sid&&""!==FC.sid||(FC.sid=e,console.log("[FoxyCart] ✓ FC.sid gesetzt:",e.substring(0,10)+"..."))}catch(e){console.warn("[FoxyCart] Konnte FC.sid nicht setzen:",e)}try{!FC.cart||FC.cart.sid&&""!==FC.cart.sid||(FC.cart.sid=e,console.log("[FoxyCart] ✓ FC.cart.sid gesetzt"))}catch(e){}return!0}return++o<10&&setTimeout(t,500),!1};t()}}(e)):console.log("[FoxyCart] Keine Session gefunden - wird bei Add-to-Cart erstellt"),o(),setTimeout(o,100),setTimeout(o,500),setTimeout(o,1e3),setTimeout(o,2e3),setTimeout(o,3e3);var t=0,a=setInterval(function(){o(),++t>=20&&(clearInterval(a),console.log("[FoxyCart] Session Persistence Interval beendet"))},1e3);(document.addEventListener("click",function(e){var o=e.target.closest('a[href*="foxycart.com"], button[data-foxy-product], form[action*="foxycart.com"]');if(o){var t=r();t&&s(o,t)}},!0),window.MutationObserver)&&new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){if(1===e.nodeType){var o=r();if(o){e.tagName&&"a"===e.tagName.toLowerCase()&&(e.href||"").includes("foxycart.com")&&s(e,o),e.tagName&&"form"===e.tagName.toLowerCase()&&(e.action||"").includes("foxycart.com")&&s(e,o);var t=e.querySelectorAll&&e.querySelectorAll('a[href*="foxycart.com"]');t&&t.forEach(function(e){s(e,o)});var n=e.querySelectorAll&&e.querySelectorAll('form[action*="foxycart.com"]');n&&n.forEach(function(e){s(e,o)})}}})})}).observe(document.body,{childList:!0,subtree:!0})}document.addEventListener("foxy-loaded",function(e){window.FC&&FC.sid&&n(FC.sid)}),document.addEventListener("foxy-cart-updated",function(e){window.FC&&FC.sid&&n(FC.sid)}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),setTimeout(a,1e3),window.foxyDebugSession=function(){console.log("=== FoxyCart Session Debug ==="),console.log("Session ID:",r()),console.log("Expires:",new Date(parseInt(localStorage.getItem(o)||"0",10))),console.log("FC Object:",window.FC),console.log("FC.sid:",window.FC&&FC.sid)}}();