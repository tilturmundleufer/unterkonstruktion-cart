!function(){"use strict";var e="foxy_session_id",o="foxy_session_expiry";function t(t){if(t)try{localStorage.setItem(e,t),localStorage.setItem(o,Date.now()+864e5),console.log("[FoxyCart] Session gespeichert:",t)}catch(e){console.warn("[FoxyCart] Konnte Session nicht speichern:",e)}}function n(){try{return parseInt(localStorage.getItem(o)||"0",10)<Date.now()?(localStorage.removeItem(e),localStorage.removeItem(o),console.log("[FoxyCart] Session abgelaufen"),null):localStorage.getItem(e)}catch(e){return console.warn("[FoxyCart] Konnte Session nicht lesen:",e),null}}function r(e,o){if(e&&o){var t=e.tagName.toLowerCase();if("a"===t){var n=e.getAttribute("href")||"";if(n&&!n.includes("fssid=")&&!n.includes("fc_sid=")){var r=n.includes("?")?"&":"?";e.setAttribute("href",n+r+"fssid="+o)}}else if("form"===t&&!e.querySelector('input[name="fssid"], input[name="fc_sid"]')){var a=document.createElement("input");a.type="hidden",a.name="fssid",a.value=o,e.appendChild(a)}}}function a(){var e=function(){var e=new URLSearchParams(window.location.search),o=e.get("fssid")||e.get("fc_sid");if(o)return console.log("[FoxyCart] Session aus URL:",o),o;var t=document.cookie.match(/(?:^|; )(?:fssid|fc_sid)=([^;]+)/);if(t)return console.log("[FoxyCart] Session aus Cookie:",t[1]),t[1];if(window.FC&&FC.sid)return console.log("[FoxyCart] Session aus FC.sid:",FC.sid),FC.sid;var r=n();return r?(console.log("[FoxyCart] Session aus localStorage:",r),r):null}();(e?t(e):e=n(),e)?(console.log("[FoxyCart] Verwende Session:",e),document.querySelectorAll('a[href*="foxycart.com/cart"]').forEach(function(o){r(o,e)}),document.querySelectorAll('form[action*="foxycart.com/cart"]').forEach(function(o){r(o,e)}),document.addEventListener("click",function(e){var o=e.target.closest('a[href*="foxycart.com"], button[data-foxy-product]');if(o){var t=n();t&&r(o,t)}},!0),window.MutationObserver&&new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){if(1===e.nodeType){var o=n();if(o){e.tagName&&"a"===e.tagName.toLowerCase()&&(e.href||"").includes("foxycart.com")&&r(e,o),e.tagName&&"form"===e.tagName.toLowerCase()&&(e.action||"").includes("foxycart.com")&&r(e,o);var t=e.querySelectorAll&&e.querySelectorAll('a[href*="foxycart.com"]');t&&t.forEach(function(e){r(e,o)});var a=e.querySelectorAll&&e.querySelectorAll('form[action*="foxycart.com"]');a&&a.forEach(function(e){r(e,o)})}}})})}).observe(document.body,{childList:!0,subtree:!0})):console.log("[FoxyCart] Keine Session gefunden - wird bei Add-to-Cart erstellt")}document.addEventListener("foxy-loaded",function(e){window.FC&&FC.sid&&t(FC.sid)}),document.addEventListener("foxy-cart-updated",function(e){window.FC&&FC.sid&&t(FC.sid)}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),setTimeout(a,1e3),window.foxyDebugSession=function(){console.log("=== FoxyCart Session Debug ==="),console.log("Session ID:",n()),console.log("Expires:",new Date(parseInt(localStorage.getItem(o)||"0",10))),console.log("FC Object:",window.FC),console.log("FC.sid:",window.FC&&FC.sid)}}();